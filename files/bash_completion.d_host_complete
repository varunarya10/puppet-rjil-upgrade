##
# To autocomplete host list for ssh and host commands.
# NOTE: this will remove autocompletion of other options, which need to be
# fixed.
#
_host_list()
{
    local cur prev host_list
    COMPREPLY=()
    cur=${COMP_WORDS[COMP_CWORD]}
    prev=${COMP_WORDS[COMP_CWORD-1]}

    from_consul=`curl -s http://localhost:8500/v1/agent/members | python -m json.tool | awk 'BEGIN {print " "} /"Name"/ {gsub ("[\",]","",$2); print $2}' | sed -r 's/ +/\n/g'`
    from_hosts=`awk '!/^#/ {print $0 }' /etc/hosts | sed -r 's/ +/\n/g'`

    case ${COMP_WORDS[1]} in
        *)
            COMPREPLY=( $( compgen -W "$from_consul $from_hosts" | grep "^$cur"
) )
            ;;
    esac

    return 0

}
complete -F _host_list ssh
complete -F _host_list host
